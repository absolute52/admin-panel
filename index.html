<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Admin Panel</title>
<style>
body { background:#0b0b0b; color:#0f0; font-family:monospace; padding:20px }
input, button { padding:10px; margin:5px; background:#111; color:#0f0; border:1px solid #0f0 }
table { width:100%; margin-top:20px }
td { border-bottom:1px solid #333; padding:8px }
</style>
</head>
<body>

<div id="login">
<h3>Вход администратора</h3>
<input id="email" placeholder="Email">
<input id="password" type="password" placeholder="Пароль">
<button onclick="login()">Войти</button>
</div>

<div id="panel" style="display:none">
<h3>Панель ключей</h3>
<input id="type" placeholder="Тип (trial/lifetime)">
<input id="days" placeholder="Дней (для trial)">
<button onclick="createKey()">Создать ключ</button>
<table id="table"></table>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
const supabase = supabase.createClient(
  "https://hmtjnadbyjwwwvpwtuzf.supabase.co",
  "sb_publishable_pg6qjLGHScckMwLkxsKZHA_jIMxnxeP"
)

async function login(){
  const email = document.getElementById("email").value
  const password = document.getElementById("password").value
  const { error } = await supabase.auth.signInWithPassword({ email, password })
  if(!error){
    login.style.display="none"
    panel.style.display="block"
    loadKeys()
  } else alert("Ошибка входа")
}

function genKey(){
  return Math.random().toString(36).substr(2,4).toUpperCase()+"-"+Math.random().toString(36).substr(2,4).toUpperCase()
}

async function createKey(){
  const type = document.getElementById("type").value
  const days = document.getElementById("days").value
  let expires = null
  if(type==="trial") expires = new Date(Date.now()+days*86400000)
  await supabase.from("licenses").insert({
    license_key: genKey(),
    type:type,
    expires_at:expires
  })
  loadKeys()
}

async function toggleKey(id,status){
  await supabase.from("licenses")
    .update({status:status==="active"?"banned":"active"})
    .eq("id",id)
  loadKeys()
}

async function loadKeys(){
  const { data } = await supabase.from("licenses").select("*")
  table.innerHTML=""
  data.forEach(k=>{
    table.innerHTML+=`
    <tr>
      <td>${k.license_key}</td>
      <td>${k.type}</td>
      <td>${k.status}</td>
      <td><button onclick="toggleKey('${k.id}','${k.status}')">
        ${k.status==="active"?"Блок":"Разблок"}
      </button></td>
    </tr>`
  })
}
</script>

</body>
</html>